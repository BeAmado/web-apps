new Vue({el:"#ctrl-app",data:{selector:"T",filterFields:{titulos:[{attr:"status",label:"Situação"},{attr:"numero",label:"Número"},{attr:"emissao",label:"Data de Emissão"},{attr:"vencimento",label:"Data de Vencimento"},{attr:"fluxo",label:"Fluxo"},{attr:"estabelecimento",label:"Estabelecimento"}],lancamentos:[{attr:"status",label:"Situação"},{attr:"documento",label:"Documento"},{attr:"data",label:"Data do Lançamento"},{attr:"fluxo",label:"Fluxo"},{attr:"estabelecimento",label:"Estabelecimento"},{attr:"conta",label:"Conta"}]},pks:{CC:"centrocusto",CF:"classificacaofinanceira",PR:"projeto"},titulosData:[{numero:"ABC123",emissao:"2024-01-13",vencimento:"2024-01-31",sinal:0,cash_flow:"IN",valor:"157.29",estabelecimento:{codigo:"AUT",descricao:"Austin"},contabilizado:!1,rateado:!1},{numero:"ABC456",emissao:"2024-01-19",vencimento:"2024-01-31",sinal:0,cash_flow:"IN",valor:298.99,estabelecimento:{codigo:"AUT",descricao:"Austin"},contabilizado:!1,rateios:{CC:[{centrocusto:"ecd55297-49ee-481c-9b9b-46b1ce7ae071",valor:200},{centrocusto:"9d6d2f54-225c-41fe-a9ce-6956b639b9b1",valor:98.99}],CF:[{classificacaofinanceira:"a094137a-9246-4c62-9154-caff85f298ca",valor:298.99}],PR:[{projeto:"50f50a3d-3b17-49e1-84f2-ea3a9246bd2c",valor:150},{projeto:"78ef0dd2-ccfc-40ae-acc7-879fcd545956",valor:130},{projeto:"d6c4398a-79a8-4455-b1af-d2b78f0fb586",valor:18.99}]}},{numero:"XYZ333",emissao:"2024-02-01",vencimento:"2024-02-07",sinal:1,cash_flow:"OUT",valor:"1579.07",estabelecimento:{codigo:"DAL",descricao:"Dallas"},contabilizado:!1,rateado:!1},{numero:"XYZ899",emissao:"2024-02-13",vencimento:"2024-02-21",sinal:1,cash_flow:"OUT",valor:"1015.89",estabelecimento:{codigo:"DAL",descricao:"Dallas"},contabilizado:!1,rateado:!1},{numero:"ABC789",emissao:"2024-02-02",vencimento:"2024-02-31",sinal:0,cash_flow:"IN",valor:"2400.00",estabelecimento:{codigo:"DAL",descricao:"Dallas"},contabilizado:!1,rateado:!1}],lancamentosData:[{documento:"DOC123",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-01-26",valor:"290.89",historico:"Pagamento de dívidas do mês passado"},{documento:"DOC456",conta:{codigo:"CTX",numero:"12345"},sinal:1,cash_flow:"IN",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-02-28",valor:"2900.89",historico:"Venda de módulo de aceleração de foguetes"},{documento:"DOC789",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-03-26",valor:"29709.23",historico:"Pagamento dos colaboradores"},{documento:"DOC123",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-01-26",valor:"290.89",historico:"Pagamento de dívidas do mês passado"},{documento:"DOC456",conta:{codigo:"CTX",numero:"12345"},sinal:1,cash_flow:"IN",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-02-28",valor:"2900.89",historico:"Venda de módulo de aceleração de foguetes"},{documento:"DOC789",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-03-26",valor:"29709.23",historico:"Pagamento dos colaboradores"},{documento:"DOC123",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-01-26",valor:"290.89",historico:"Pagamento de dívidas do mês passado"},{documento:"DOC456",conta:{codigo:"CTX",numero:"12345"},sinal:1,cash_flow:"IN",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-02-28",valor:"2900.89",historico:"Venda de módulo de aceleração de foguetes"},{documento:"DOC789",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-03-26",valor:"29709.23",historico:"Pagamento dos colaboradores"},{documento:"DOC123",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-01-26",valor:"290.89",historico:"Pagamento de dívidas do mês passado"},{documento:"DOC456",conta:{codigo:"CTX",numero:"12345"},sinal:1,cash_flow:"IN",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-02-28",valor:2900.89,historico:"Venda de módulo de aceleração de foguetes",rateios:{CC:[{centrocusto:"ecd55297-49ee-481c-9b9b-46b1ce7ae071",valor:2e3},{centrocusto:"9d6d2f54-225c-41fe-a9ce-6956b639b9b1",valor:900.89}],CF:[{classificacaofinanceira:"a094137a-9246-4c62-9154-caff85f298ca",valor:2900.89}],PR:[{projeto:"50f50a3d-3b17-49e1-84f2-ea3a9246bd2c",valor:1500},{projeto:"78ef0dd2-ccfc-40ae-acc7-879fcd545956",valor:1300},{projeto:"d6c4398a-79a8-4455-b1af-d2b78f0fb586",valor:100.89}]}},{documento:"DOC789",conta:{codigo:"CTX",numero:"12345"},sinal:0,cash_flow:"OUT",estabelecimento:{codigo:"AUT",descricao:"Austin"},data:"2024-03-26",valor:"29709.23",historico:"Pagamento dos colaboradores"}],projetos:[{projeto:"50f50a3d-3b17-49e1-84f2-ea3a9246bd2c",codigo:"PR.01",nome:"Projeto #1"},{projeto:"390d781e-f586-4ab0-b608-d4fdc87f5b94",codigo:"PR.02",nome:"Projeto #2"},{projeto:"f3359744-2ebd-48d0-862e-52901501242e",codigo:"PR.03",nome:"Projeto #3"},{projeto:"78ef0dd2-ccfc-40ae-acc7-879fcd545956",codigo:"PR.04",nome:"Projeto #4"},{projeto:"d6c4398a-79a8-4455-b1af-d2b78f0fb586",codigo:"PR.05",nome:"Projeto #5"}],classfin:[{classificacaofinanceira:"bfc6cc68-be23-4430-9c83-5c2bf3b9abd9",codigo:"CF.01",descricao:"Class. Fin. #1"},{classificacaofinanceira:"a094137a-9246-4c62-9154-caff85f298ca",codigo:"CF.02",descricao:"Class. Fin. #2"},{classificacaofinanceira:"a582f32b-1f01-42df-b3e0-24558254987b",codigo:"CF.03",descricao:"Class. Fin. #3"},{classificacaofinanceira:"844db916-0df1-44ed-954f-b93e37f48d3b",codigo:"CF.04",descricao:"Class. Fin. #4"},{classificacaofinanceira:"ec81093a-8215-4a45-a153-07361bbe8c9f",codigo:"CF.05",descricao:"Class. Fin. #5"}],centros:[{centrocusto:"5ba58cb6-96a9-455f-9466-985da79e3dac",codigo:"CC.01",descricao:"Centro de Custo #1"},{centrocusto:"9d6d2f54-225c-41fe-a9ce-6956b639b9b1",codigo:"CC.02",descricao:"Centro de Custo #2"},{centrocusto:"ecd55297-49ee-481c-9b9b-46b1ce7ae071",codigo:"CC.03",descricao:"Centro de Custo #3"},{centrocusto:"0bb5cc9c-c3a2-494a-a9f7-c6d45a84596b",codigo:"CC.04",descricao:"Centro de Custo #4"},{centrocusto:"06837fe1-386d-4dc8-afd9-90e1ed170dc9",codigo:"CC.05",descricao:"Centro de Custo #5"}],selectedDoc:null,virtualApports:null,filterText:""},computed:{titulos:function(){return this.titulosData.map((o=>this.parseTitulo(o)))},filteredTitulos:function(){return this.filterTitulosUsingTextFilter(this.titulosData.map((o=>this.parseTitulo(o))),this.filterText)},lancamentos:function(){return this.lancamentosData.map((o=>this.parseLancamento(o)))},filteredLancamentos:function(){return this.filterLancamentosUsingTextFilter(this.lancamentosData.map((o=>this.parseLancamento(o))),this.filterText)},titulosIsActive:function(){return"T"==this.selector},lancamentosIsActive:function(){return"L"==this.selector},anyDocumentSelected:function(){return null!=this.selectedDoc},availableFilters:function(){return"T"==this.selector?this.filterFields.titulos:this.filterFields.lancamentos},changedApports:function(){return!!this.virtualApports&&!this.sameApports(this.apportsValues(this.selectedDoc.rateios),this.apportsValues(this.virtualApports))},filterPlaceholder:function(){return`Pesquisar por ${"T"==this.selector?"número":"documento, histórico"}, estabelecimento ou valor`}},filters:{round2:function(o){return"number"==typeof o?o.toFixed(2):o},money:function(o){return"R$"+o.replace(".",",")},percent:function(o){return o.replace(".",",").replace("%","")+"%"}},methods:{apports1InApports2:function(o,e){for(let t of Object.keys(o)){if(!(t in e))return!1;for(let a of Object.keys(o[t])){if(!(a in e[t]))return!1;if(e[t][a]!=o[t][a])return!1}}return!0},sameApports:function(o,e){return this.apports1InApports2(o,e)&&this.apports1InApports2(e,o)},parseDocumento:function(o){return{fluxo:"IN"==o.cash_flow?"Entrada":"Saída",valor:o.valor,estabelecimento:o.estabelecimento.codigo+" - "+o.estabelecimento.descricao,contabilizado:o.contabilizado,status:"Ação "+(o.rateios&&Object.keys(o.rateios).length>0?"realizada":"pendente"),rateios:o.rateios,rateado:o.rateios&&Object.keys(o.rateios).length>0}},parseTitulo:function(o){return(e=this.parseDocumento(o)).numero=o.numero,e.emissao=o.emissao,e.vencimento=o.vencimento,e;var e},parseLancamento:function(o){return(e=this.parseDocumento(o)).documento=o.documento,e.conta=o.conta.codigo+" - "+o.conta.numero,e.historico=o.historico,e.data=o.data,e;var e},filterTitulosUsingTextFilter:function(o,e){return e&&e.trim().length>0?o.filter((o=>Number(o.valor).toFixed(2).replace(".",",").includes(e)||o.numero.toLowerCase().includes(e.toLowerCase())||o.estabelecimento.toLowerCase().includes(e.toLowerCase()))):o},filterLancamentosUsingTextFilter:function(o,e){return e&&e.trim().length>0?o.filter((o=>Number(o.valor).toFixed(2).replace(".",",").includes(e)||o.documento.toLowerCase().includes(e.toLowerCase())||o.estabelecimento.toLowerCase().includes(e.toLowerCase())||o.historico.toLowerCase().includes(e.toLowerCase()))):o},copyObj:function(o){return"object"==typeof o?Array.isArray(o)?o.map((o=>this.copyObj(o))):(e=>(Object.keys(o).forEach((t=>{e[t]=this.copyObj(o[t])})),e))({}):o},apportsValues:function(o){return(e=>(Object.keys(e).forEach((t=>{o&&t in o&&o[t].forEach((o=>{e[t][o[this.pks[t]]]=o.valor}))})),e))({CC:{},CF:{},PR:{}})},getVirtualApports:function(o){return(e=>(o.rateios&&Object.keys(o.rateios).forEach((t=>{t in e&&o.rateios[t].forEach((o=>{e[t].push(this.copyObj(o))})),e[t].forEach((o=>{"percent"in o||this.calculatePercent(o)}))})),e))({CC:[],CF:[],PR:[]})},setApports:function(o,e){o.rateios=this.getVirtualApports({rateios:e})},addVirtualApport:function(o){this.virtualApports[o].push((e=>(e[this.pks[o]]="",e.valor=0,e))({}))},editApportValue:function(o,e,t){this.virtualApports[o][e].valor=t},removeVirtualApport:function(o,e){this.virtualApports&&this.virtualApports[o]&&this.virtualApports[o].splice(e,1)},saveApports:function(){this.setApports(this.selectedDoc,this.virtualApports),this.closeModal()},calculatePercent:function(o){o.percentual=Math.round(o.valor/(this.selectedDoc.valor||1)*1e4)/100},calculateValue:function(o){o.valor=Math.round(o.percentual*(this.selectedDoc.valor||0))/100},selectTitulos:function(){this.selector="T"},selectLancamentos:function(){this.selector="L"},openModal:function(o){this.selectedDoc=o,this.virtualApports=this.getVirtualApports(o)},closeModal:function(){this.selectedDoc=null,this.virtualApports=null},getTotalValue:function(o){return this.virtualApports&&this.virtualApports[o]?this.virtualApports[o].reduce(((o,e)=>o+e.valor),0):0},getTotalPercent:function(o){return this.getTotalValue(o)/this.selectedDoc.valor*100},loadTitulos:function(){fetch("../data/titulos.json").then((o=>o.json())).then((o=>{this.titulosData.length=0,o.forEach((o=>{this.titulosData.push(o)}))})).catch((o=>{}))},loadLancamentos:function(){fetch("../data/lancamentos.json").then((o=>o.json())).then((o=>{this.lancamentosData.length=0,o.forEach((o=>{this.lancamentosData.push(o)}))})).catch((o=>{}))}}});